/// <reference types="cypress" />

describe('Registration Flow', () => {
  beforeEach(() => {
    cy.visit('/register');
  });

  it('should display registration form', () => {
    cy.contains(/register|sign up/i).should('be.visible');
    cy.get('input#name').should('be.visible');
    cy.get('input#email').should('be.visible');
    cy.get('input#password').should('be.visible');
    cy.get('input#password_confirm').should('be.visible');
  });

  it('should register a new patient successfully', () => {
    const timestamp = Date.now();
    
    cy.contains('button', /patient/i).click();
    
    cy.get('input#name').type('Test Patient');
    cy.get('input#email').type(`patient${timestamp}@test.com`);
    cy.get('input#phone').type('+1234567890');
    cy.get('input#password').type('TestPass123!');
    cy.get('input#password_confirm').type('TestPass123!');
    cy.get('button[type="submit"]').click();
    
    cy.url().should('include', '/login', { timeout: 10000 });
  });

  it('should register a new pharmacy successfully', () => {
    const timestamp = Date.now();
    
    cy.contains('button', /pharmacy/i).click();
    
    cy.get('input#name').type('Test Pharmacy');
    cy.get('input#email').type(`pharmacy${timestamp}@test.com`);
    cy.get('input#phone').type('+1234567890');
    cy.get('input#address').type('123 Main Street, City, Country');
    cy.get('input#password').type('TestPass123!');
    cy.get('input#password_confirm').type('TestPass123!');
    cy.get('button[type="submit"]').click();
    
    cy.url().should('include', '/login', { timeout: 10000 });
  });

  it('should show error for password mismatch', () => {
    cy.get('input#name').type('Test User');
    cy.get('input#email').type('test@test.com');
    cy.get('input#phone').type('+1234567890');
    cy.get('input#password').type('Password123');
    cy.get('input#password_confirm').type('DifferentPass123');
    cy.get('button[type="submit"]').click();
    
    cy.contains(/password.*match/i).should('be.visible');
  });

  it('should show error for invalid email', () => {
    cy.get('input#email').type('invalidemail');
    cy.get('input#email').blur();
    
    cy.get('input#email').should(($input) => {
      const inputElement = $input[0] as HTMLInputElement;
      expect(inputElement.validity.valid).to.be.false;
    });
  });
});
